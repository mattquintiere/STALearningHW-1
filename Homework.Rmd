---
title: 'Homework #1'
author: "Matt Quintiere and Rohit Gunda"
date: "2023-10-16"
output:
  html_document:
    df_print: paged
---

### Setup

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries}
library(tidyverse)
library(tidymodels)
library(dplyr)
library(knitr)
library(palmerpenguins)
library(GGally)
library(factoextra)
library(psych)
view(penguins_raw)
```

### Introduction

```{r original-dataset}
penguins_raw <- penguins_raw
```

Introduction of data: The dataset we aim to analyze contains data on 344 penguins. This dataset contains data on 3 species of penguins (Adelie, Chinstrap, and Gentoo) from 3 islands in the Palmer Archipelago (Torgerson, Biscoe, and Dream). There are 17 variables in the dataset, and they consist of the following:

-   **studyName:** Sampling expedition from which data were collected, generated, etc.

-   **Sample Number:** an integer denoting the continuous numbering sequence for each sample

-   **Species:** a character string denoting the penguin species

-   **Region:** a character string denoting the region of Palmer LTER sampling grid

-   **Island:** a character string denoting the island near Palmer Station where samples were collected

-   **Stage:** a character string denoting reproductive stage at sampling

-   **Individual ID:** a character string denoting the unique ID for each individual in dataset

-   **Clutch Completion:** a character string denoting if the study nest observed with a full clutch, i.e., 2 eggs

-   **Date Egg:** a date denoting the date study nest observed with 1 egg (sampled)

-   **Culmen (bill) Length:** a number denoting the length of the dorsal ridge of a bird's bill (millimeters)

-   **Culmen (bill) Depth:** a number denoting the depth of the dorsal ridge of a bird's bill (millimeters)

-   **Flipper Length:** an integer denoting the length penguin flipper (millimeters)

-   **Body Mass:** an integer denoting the penguin body mass (grams)

-   **Sex:** a character string denoting the sex of an animal

-   **Delta 15 N:** a number denoting the measure of the ratio of stable isotopes 15N:14N

-   **Delta 13 C:** a number denoting the measure of the ratio of stable isotopes 13C:12C

-   **Comments:** a character string with text providing additional relevant information for data

Motivation: We decided to use this dataset for analysis because we were interested to see if there was any variation in some of the key metrics between penguins of different species or penguins of different islands. As a result, our main research question is: Is there a relationship between the certain categorical variables (such as species, island, and sex) and the size of certain aspects of the penguin (such as bill length/depth, body mass, and flipper length)?

```{r data-cleaning}

penguins_mod <- penguins_raw |>
  select(-studyName, -`Sample Number`, -Region, -`Individual ID`, -Stage, 
         -`Clutch Completion`, -`Date Egg`, -`Delta 15 N (o/oo)`, 
         -`Delta 13 C (o/oo)`, -Comments)

```

Here, we have only kept the variables that would be useful in our analysis.

```{r remove-na}
#Removing NAs in the dataset
penguins2 <- penguins_mod[rowSums(is.na(penguins)) < 2, ]
```

```{r outliers}
penguins2 <- penguins2 |>
  mutate(
    Species = case_when(
      Species == "Adelie Penguin (Pygoscelis adeliae)" ~ "Adelie",
      Species == "Gentoo penguin (Pygoscelis papua)" ~ "Gentoo",
      Species == "Chinstrap penguin (Pygoscelis antarctica)" ~ "Chinstrap"
    )
  )

ggplot(penguins2,aes(x=Species, y=`Culmen Length (mm)`)) + 
  geom_boxplot() 
ggplot(penguins2,aes(x=Species, y=`Culmen Depth (mm)`)) + 
  geom_boxplot() 
penguins2 <- penguins2 %>% 
  mutate(outlier = ifelse(`Culmen Length (mm)` > 58, FALSE, TRUE))
penguins2 <- penguins2 %>% 
  filter(outlier == TRUE)
penguins2 <- penguins2 %>% 
  mutate(outlier2 = ifelse(`Culmen Depth (mm)` > 21.2, FALSE, TRUE))
penguins2 <- penguins2 %>% 
  filter(outlier2 == TRUE)
penguins2 <- penguins2 %>% 
  select(Species, Island, `Culmen Length (mm)`, `Culmen Depth (mm)`,
         `Flipper Length (mm)`, `Body Mass (g)`, Sex)
  
```

### PCA

To explore the principal components of our data set to explain the variability, we have to isolate the numeric variables in the dataset, which are `Culmen Length (mm)`, `Culmen Depth (mm)`, `Flipper Length (mm)length_mm`, `Body Mass (g)`. The reason we can only use numeric variables is because the PCA relies linear algebra calculations which can only be used with numeric data.

```{r}
pca_penguins2 <- penguins2[,3:6]

pca = prcomp(pca_penguins2, scale = TRUE)
```

Let's visualize how correlated these variables are by doing bivariate analysis:

```{r}
ggcorr(penguins2[,3:6], label = TRUE, label_size = 3, hjust = 0.55, size =3)
```

From the correlation matrix, we can see that `Body Mass (g)` is very correlated with `Flipper Length (mm)`. Also `Culmen Length (mm)` has a somewhat strong correlation with `Flipper Length (mm)` and `Body Mass (g)`, while `Bill Depth (mm)` has a negative correlation with all of the variables and does not have a strong correlation with any of the variables.

```{r}
summary(pca)
```

Running the PCA calculations out using the prcomp tool, we see that the first two principal components are responsible for about 88% percent of the data. Let's create a screeplot to visualize this:

```{r}
fviz_eig(pca, addlabels = TRUE,
         ylim = c(0,80))
```

Now let's apply the Kaiser rule to select the number of components, we will use in the PCA:

```{r}
fviz_eig(pca, 
         addlabels = TRUE, 
         ylim = c(0,4),
         choice="eigenvalue",
         main="Scree Plot with Kaiser Rule") +
         geom_hline(yintercept=1, 
         linetype="dashed", 
         color = "red")
```

Only our first principal component has an eigenvalue greater than one, so our analysis will focus on the first principal component to start, which explains about 69% of the variability and is the maximum variance direction in the data. Now let's look at what variables contribute the most to our first principal component:

```{r}
fviz_contrib(pca, choice = "var", axes = 1)
```

On average, each variable is expected to contributed 25% to the first principal component. However, only two of those variables `Flipper Length (mm)` and `Body Mass (g)` contribute over 25% to the first principal component. We should note that a reason that this could occur is that `Flipper Length (mm)` and `Body Mass (g)` are highly correlated. Let's visualize this correlated relationship with respect to `species`:

```{r}
penguins2 %>% 
  ggplot(aes(x = `Flipper Length (mm)`, y = `Body Mass (g)`, color = Species)) +
  geom_point() +
  labs(y = "Body Mass (Grams)",
       x = "Flipper Length (mm)",
       title = "Relationship between Flipper Length and Body Mass",
       subtitle = "Seperated by Species",
       color = "Species") +
  geom_smooth(method = "lm")
```

From this chart, we can see the differentiation of the Gentoo species from the Adelie and Chinstrap species of Penguins, as the Gentoo species tends to have a greater body mass and flipper length. However, Adelie and Chinstrap are not differentiable based on their flipper length and body mass relationship. Therefore, the first principal component is an overall measure for the size of the penguins which differentiates the Gentoos. Another thing to note, is the strong postive correlation trend that `Body Mass (g)` and `Flipper Length (mm)` have as shown in the correlation plot and for each of the species. Let's circle back to principal component two, so we can find a way to differentiate the Adelie and Chinstrap species:

```{r}
fviz_contrib(pca, choice = "var", axes = 2)
```

In principal component two, the two other variables contribute more than expected. Let's visualize the relationship of `Culmen Length (mm)` and `Culmen Depth (mm)` with respect to species:

```{r}
penguins2 %>% 
  ggplot(aes(x = `Culmen Depth (mm)`, y = `Culmen Length (mm)`, color = Species)) +
  geom_point() +
  labs(x = "Bill Depth (mm)",
       y = "Bill Length (mm)",
       title = "Relationship between Bill Length and Depth",
       subtitle = "Seperated by Species",
       color = "Species") +
  geom_smooth(method = "lm")
```

The Principal Component 2 is explained primarily by `Culmen Length (mm)` and `Culmen Depth (mm)`. From looking at the scatter plot above, we can determine that Chinstrap penguins have similar bill depths as Adelie penguins, but much larger lengths. Also, despite being smaller penguins in size, the Chinstrap and Adelie penguins have a larger bill depths than Gentoo Penguins. Gentoo Penguins; however, have a much larger bill length than Adelie penguins. Also, it is interesting to note that `Culmen Depth (mm)` and `Culmen Length (mm)` are not strongly correlated based on our correlation matrix, but their relationship with respect species allows us to further differentiate the penguins species.

### Factor Analysis

After determining the meaning of our first two principal components and using the PCA to attempt to explain the total variance, we will move on to completing a factor analysis in order to better explain the variance and covariance of the observed variables in our data set by a set of fewer latent variables. Let's test if our factor analysis will run:

```{r}
det(cor(pca_penguins2))
```

Our determinant is postive, so that means our factor analysis will most likely run.

We will be using the principal axis factor analysis and maximum likelihood factor analysis methods and only be using a total of 2 factors based on the reasoning from the PCA above. We will also be using the varimax rotational method which will minimize the number of variables that have high loadings on each factor and simplify the interpretation of each factor. We will use the method that has the highest culmative variance on the second factor.

```{r}
pa <- fa(r = pca_penguins2,
         nfactors =2,
         rotate = "varimax",
         fa = "pa",
         resdiuals = TRUE)
ml <- fa(r = pca_penguins2,
         nfactors =2,
         rotate = "varimax",
         fa = "ml",
         resdiuals = TRUE)
```

The PA and ML methods both produce a cumulative variance of 0.72, so either method will work in this case. We will use the ML method going ahead. So let's view and interpret the results:

```{r}
ml
```

```{r}
fa.diagram(ml)
```

```{r}
barplot(ml$loadings[,1], las=2, names =F,col="beige", ylim = c(-1, 1))
barplot(ml$loadings[,2], las=2, names = F, col="beige", ylim = c(-1, 1))
```

From these charts and tables, we can determine that the first factor (MR1) is related to `Flipper Length (mm)`, `Body Mass (g)`, and `Culmen Length (mm)`. However, `Culmen Length (mm)` is a feature that is poorly explained by factor analysis because less 50% of its variance is explain by the two given factor loadings. `Flipper Length (mm)` is the best explained variable by factor analysis as over 99% of its variance is explained by the two factor loading. Therefore, the first factor loading represents the size of the penguins as it did in the PCA and it causes the flipper lengths and masses of the penguins. The second loading factor is most related to `Culmen Depth (mm)` as `Culmen Depth (mm)` has the highest MR2 value in absolute value. The second factor loading once again represents the shape of the beak, but is not as well explained as the second principal component analysis as `Culmen Length (mm)` is not well explained by the second factor loading. The second factor loading is also somewhat related to `Flipper Length (mm)` and `Body Mass (g)`, which also have the highest complexity variables. This means that these two variables do most of the explanation of the variance and covariance in the data set. According to our factor analysis, `Culmen Length (mm)` does not explain a large amount of the variance in the data set and should be considered to be taken out of models trying to predict the species or island of a given penguin.

Similar to the PCA, we were able reduce our data into two-dimensions with the size of the Penguin and the shape of the beak. It is interesting to note that the first loading factor did a much better job at explaining the variances and covariances of the variables than the second loading factor. This may have occured because `Culmen Depth (mm)` is not that strongly correlated with the other numeric variables and the only prinicpal component that has an eigenvalue greater than 1 is the first one, which does not include `Culmen Depth (mm)` and `Culmen Depth (mm)` is the main variable in the second loading factor.

Let's move onto our final unsupervised learning method to further explore our data before we make final conclusions.

### Cluster Analysis

Load important clustering libraries:

```{r load-cluster-libraries}

library(factoextra)
library(cluster)
library(mclust)
```

Initial guess for the number of clusters: 3 (signifies the number of species, as well as the number of islands that our data comes from). However, we believe the clusters are the species that each penguin is, as there is a higher variation between species of penguin versus the island that the penguin resides on. The islands could all have an even distribution of species of penguins, so it makes more sense that species is the cluster we should be focusing on.

```{r guess-clusters}
k = 3
fit = kmeans(scale(pca_penguins2), centers=k, nstart=1000)
groups = fit$cluster
barplot(table(groups), col="blue")
```

Now to interpret the centers:

```{r interpretation-of-centers}

centers=fit$centers

barplot(centers[1,], las=2, col="darkblue")
barplot(centers[2,], las=2, col="darkblue")
barplot(centers[3,], las=2, col="darkblue")


```

One cluster seems to have the characteristics of having a longer `Culmen depth (mm)`, as seen by the analysis of the centers of our data.

Another cluster seems to have the characteristics of having a much lower `Culmen length (mm)`.

The final cluster seems to have the characteristics of having a longer `Flipper Length (mm)` and `Body Mass (g)`.

Based on this, we can see some of the major differences between each cluster. Specifically, we see these cluster-specific differences in characteristics such as `Culmen length/depth (mm)`, `Body Mass (g)`, and `Flipper Length (mm)`.

Now, let us confirm the most optimal amount of clusters, per the silhouette method.

```{r optimal-clusters}
fviz_nbclust(scale(pca_penguins2), kmeans, method = 'silhouette', k.max = 20, nstart = 1000) # With this you select the best number of clusters

```

```{r kernel-k-means}

library(kernlab)

fit.ker <- kkmeans(as.matrix(pca_penguins2), centers=3, kernel="rbfdot") # Radial Basis kernel (Gaussian)
# By default, Gaussian kernel is used
# By default, sigma parameter is estimated

centers(fit.ker)
size(fit.ker)
withinss(fit.ker)

object.ker = list(data = pca_penguins2, cluster = fit.ker@.Data)

fviz_cluster(object.ker, geom = c("point"), ellipse=F,pointsize=1) +
  theme_minimal() #+
  #geom_text(label=names,hjust=0, vjust=0,size=2,check_overlap = T) +
  #scale_fill_brewer(palette="Paired")
```

As seen by the above Kernel k-means analysis, we are using 2 of the principal components to visualize the data. Again, the first 2 principal components make up 88% of the variability. In the above plot, we see 2 very clear groups of points. In the group on the left, it is mainly dominated by clusters 1 and 3, but the one on the right is dominated mainly by points from cluster 2. We found this very interesting as we had expected to see 3 clear clusters, one for each species. However, we only see two, and in one of the groups, points from two clusters are mixed quite evenly. However, k-means are mainly used for highly non-linear data, so maybe another approach to identify clusters may be beneficial to use.

Per our above analysis on the optimal number of clusters, as well as the plot showing the relationship between `Flipper Length (mm)` and `Body Mass (g)`, we will now use 2 clusters as the "guess" when analyzing our centers.

```{r}

y = 3
fit = kmeans(scale(pca_penguins2), centers=y, nstart=1000)
groups = fit$cluster
barplot(table(groups), col="blue")
```

Interpret the centers:

```{r}

centers=fit$centers

barplot(centers[1,], las=2, col="darkblue")
barplot(centers[2,], las=2, col="darkblue")

```

Now, the differences between both clusters are much more distinct. `Culmen Depth (mm)` is notably higher in the first cluster, whereas the other 3 key continuous variables (`Culmen Length (mm)`, `Flipper Length (mm)`, and `Body Mass (g)`), are noticeably higher in the second one.

To conclude, we originally thought that there would be three clusters, as species was a clear defining categorical variable that can be used to distinguish between penguins. However, after looking at the plots of the principal components, as well as the optimal cluster analysis, we can conclude that there are 2 clusters in our data.

### Conclusion

To conclude,

It is essential to outline some of the main distinguishing factors between the 3 species of penguins that we are analyzing. Upon looking at the plot which displays the relationship between `Flipper Length (mm)` and `Body Mass (g)`, we can see that the Gentoo penguins are in its own group in the top right, while the Adelie and Chinstrap penguins are more in their own group, with their characteristics being more similar. In fact, Gentoo penguins are the third largest species of Penguin, while the Adelie and Chinstrap penguins are 6th and 5th largest, respectively. Adelie penguins also are known to have smaller bills, contributing to a smaller length and depth. Understanding the variations between the species is essential to draw some of the conclusions from our analysis.

To address our research question, we can conclude that categorical variables such as species does contribute to certain quantitative variables such as size of certain characteristics of the penguins.

answer research question

final thoughts
